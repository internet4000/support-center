{{ $currentNode := . }}

<ul class="list pa0 ma0">
	<li class="{{if .IsHome}}active{{end}}">
		<a class="black db pa2" href="/">Home</a>
	</li>
	{{if eq .Site.Params.ordersectionsby "title"}}
		{{range .Site.Home.Sections.ByTitle}}
		{{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
		{{end}}
	{{else}}
		{{range .Site.Home.Sections.ByWeight}}
		{{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
		{{end}}
	{{end}}
</ul>

<!-- templates -->
{{ define "section-tree-nav" }}
{{ $currentNode := .currentnode }}
 {{with .sect}}
	{{if .IsSection}}
		{{safeHTML .Params.head}}
		<li data-nav-id="{{.URL}}" title="{{.Title}}" class="{{if .IsAncestor $currentNode }}parent{{end}} {{if eq .UniqueID $currentNode.UniqueID}}active{{end}} {{if .Params.alwaysopen}}parent{{end}}">
			<a class="black db pa2" href="{{.RelPermalink}}">
				{{safeHTML .Params.Pre}}{{or .Params.menuTitle .LinkTitle .Title}}{{safeHTML .Params.Post}}
			</a>
			{{ $numberOfPages := (add (len .Pages) (len .Sections)) }}
			{{ if ne $numberOfPages 0 }}
				<ul class="list pl3">
					{{ .Scratch.Set "pages" .Pages }}
					{{ if .Sections}}
						{{ .Scratch.Set "pages" (.Pages | union .Sections) }}
					{{end}}
					{{ $pages := (.Scratch.Get "pages") }}

				{{if eq .Site.Params.ordersectionsby "title"}}
					{{ range $pages.ByTitle }}
						{{ if and .Params.hidden (not $.showhidden) }}
						{{else}}
						{{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode}}
						{{end}}
					{{ end }}
				{{else}}
					{{ range $pages.ByWeight }}
						{{ if and .Params.hidden (not $.showhidden) }}
						{{else}}
						{{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode}}
						{{end}}
					{{ end }}
				{{end}}
				</ul>
			{{ end }}
		</li>
	{{else}}
		{{ if not .Params.Hidden }}
			<li data-nav-id="{{.URL}}" title="{{.Title}}" class="dd-item {{if eq .UniqueID $currentNode.UniqueID}}active{{end}}">
				<a class="black db pa2" href="{{ .RelPermalink}}">
				{{safeHTML .Params.Pre}}{{or .Params.menuTitle .LinkTitle .Title}}{{safeHTML .Params.Post}}
				</a>
		</li>
		 {{ end }}
	{{end}}
 {{ end }}
{{ end }}
